<!DOCTYPE html>
<html>
<head>
  <title>Ziwei Calculator in JS playground</title>
  <link href="data:image/x-icon;base64,
    iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAlwSFlzAAAL
    EwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6
    eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYg
    eG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4K
    ICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlm
    Zj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRh
    dGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9y
    ZGY6UkRGPgo8L3g6eG1wbWV0YT4KTMInWQAAA5VJREFUOBFNk/1PW1UYx59zb2/XtWXtGJTejArS
    DpWBIojMdCPZ5pwhZrKBW/wTSPeDQLaQGeOcv0hMSPzJXxhCGMbpFmOykUwzg8hginN1xRZ5GX3v
    7RvQwu3dvbf3Hs/Fsfgk5yU5z+c5z/fkexD8FzRZlKf7195/73Sn232kVU/BfoPRiJ9IxdjM1OT9
    kW9ufEdyvE/znjHaRgt9c0vLZ2OjI3x4dQXP3buDuehjLAo8jgYX8fLCPB4fvbr5igM+Jbk7jG6b
    1ODz3d3f+v1+rKoqVhVJ+u3ehFgQeDmRiMg/3PhSXP7nL6koi9j35+/47DtvjhKG0mCkTee6ugb6
    +y9cBJVX9paxqsG4l1lc8IEqSyBJItD6XfC8sxbWM2HJZqtkchs8qm9s+pigV7QqzZ1dnR9YrSWQ
    ScfU/GaBuT/5I456p2ArsQJKLgm5UAACD//AQO3WZzKcXHPABde/Hu8lbAPd19PTc/KtY21FuSA7
    nI3MgncOq+sR1HTsNNS3HgVXfTOU2SshG/ob8UIRv9zSplMVWaaQaowFQ1ndS3V1hxgGQZLj0BOJ
    Aj6xhFpPnoXq2jpyAQCXTMKs1w+ATaBfj8PSwjxkUyu4tJSFE2+3H9IR1uZw1IBlnw0FvA+h1O4A
    azkLi0tLYK+ogOGhIcisrUE6lYKjB1m0r4aH193tiKEQTE8/2E8hilIxViG/sQaIPKmiSCAIBbBa
    rJDJpGF2dgacTifkcnkQRQFMJjNZeUglo0DrdEAVRCkZj4chGgxgTWtRFPFPt78Hnz8AQ1eH4dbt
    CTjv8YAZ56Gy2oUZgxEyyQguCALkeSFKA+ZdpzrOtblq6xRFxbQgFiG9PIe+6O+G8YlfwcIAnDrx
    BrQfPwysqxFV1b4Az1U51a0tiX63o2Nc80H9tbGx2TNnOszeBz/LCt7F6DCFc4lVlEpxQGwFdtKZ
    xV6FDSUlqLCVlppajuuHvxrJezyeI9tGIkU+mpq8e8VWZlaJcZRy1sXEIqvEr3hbJ0/aPfBiA5Hp
    l7OpGG3Y46Dc7sOfEO7yjqen44lEVUND46tECm0yGeT1bByX2li1vIJVI6s+1Ww2KxVsNROMJFFf
    36VrHBfXjITJePYxtG4+HBwczPsePcKh4DLmYkG8sZbG4dAKnvrlLv58YGCT5Fz+H0PvSNA62fnO
    moO6ensvtFr2mFhFLtKCVOSu37w1E348f5OczZOhxTbzL+FXtFV64DG6AAAAAElFTkSuQmCC"
    rel="icon" type="image/x-icon" />
  <link rel="stylesheet" type="text/css" href="views/styles.css">
  <script type="text/javascript" src="configs/branch_sets.js"></script>
  <script type="text/javascript" src="configs/branches.js"></script>
  <script type="text/javascript" src="configs/forteen_main_stars.js"></script>
  <script type="text/javascript" src="configs/four_transformation_stars.js"></script>
  <script type="text/javascript" src="configs/genders.js"></script>
  <script type="text/javascript" src="configs/loc_ton_constellation.js"></script>
  <script type="text/javascript" src="configs/normal_stars.js"></script>
  <script type="text/javascript" src="configs/other_important_stars.js"></script>
  <script type="text/javascript" src="configs/palaces.js"></script>
  <script type="text/javascript" src="configs/six_deadly_stars.js"></script>
  <script type="text/javascript" src="configs/six_lucky_stars.js"></script>
  <script type="text/javascript" src="configs/stems.js"></script>
  <script type="text/javascript" src="configs/thai_tue_constellation.js"></script>
  <script type="text/javascript" src="configs/trang_sinh_constellation.js"></script>
  <script type="text/javascript" src="configs/tuan_triet.js"></script>
  <script type="text/javascript" src="configs/wuxing.js"></script>
  <script type="text/javascript" src="models/gan_zhi.js"></script>
  <script type="text/javascript" src="models/result_palace.js"></script>
  <script type="text/javascript" src="models/result_table.js"></script>
  <script type="text/javascript" src="models/profile.js"></script>
  <script type="text/javascript" src="models/calculator.js"></script>
  <script type="text/javascript" src="utils/extensions.js"></script>
  <script type="text/javascript" src="utils/calc_commons.js"></script>
  <script type="text/javascript" src="utils/calc_forteen_main_stars.js"></script>
  <script type="text/javascript" src="utils/calc_four_transformation_stars.js"></script>
  <script type="text/javascript" src="utils/calc_normal_stars.js"></script>
  <script type="text/javascript" src="utils/calc_other_important_stars.js"></script>
  <script type="text/javascript" src="utils/calc_sequential_constellations.js"></script>
  <script type="text/javascript" src="utils/calc_six_deadly_stars.js"></script>
  <script type="text/javascript" src="utils/calc_six_lucky_stars.js"></script>
  <script type="text/javascript" src="utils/calc_tuan_triet.js"></script>
  <script type="text/javascript" src="utils/reuse_utils.js"></script>
  <script type="text/javascript" src="utils/views_generator.js"></script>
  <script type="text/javascript" src="ziwei.js"></script>
  <!-- <script type="text/javascript" src="vendors/ziwei.es6.js"></script> -->
  <!-- <script type="text/javascript" src="vendors/ziwei.es5.js"></script> -->
  <!-- <script type="text/javascript" src="vendors/ziwei.min.js"></script> -->
  <script type="text/javascript" src="vendors/jquery.min.js"></script>
  <script type="text/javascript" src="vendors/handlebars.min.js"></script>
  <script type="text/javascript">
    function setupDropdownValues() {
      // Birth dates: 1 - 30
      var dates = Array.fromRange(1, 30).map((day) =>
        '<option value="' + day + '">' + day + '</value>'
      ).join("\n");
      $('#birthDay').append(dates);

      // Birth hour & birth year branch: Ty - Suu - Dan - Mao - Thin - Ty - Ngo - Mui - Than - Dau - Tuat - Hoi
      var branchNames = Ziwei.Configs.Branches.Names;
      var branches = branchNames.mapKeyValues((branch, name) =>
        '<option value="' + branch + '">' + name + '</value>'
      ).join("\n");
      $('#birthHour').append(branches);
      $('#birthYearBranch').append(branches);

      // Birth month: Dan - Mao - Thin - Ty - Ngo - Mui - Than - Dau - Tuat - Hoi - Ty - Suu
      var lunarMonths = branchNames.allKeys().map((branch, index) =>
        '<option value="' + branch + '">' + branchNames[branch] + ' (' + (index+1).limitInc(-2) + ')</value>'
      );

      var lunarMonths = $.merge(lunarMonths.slice(2, lunarMonths.length), lunarMonths.slice(0, 1)).join("\n");
      $('#birthMonth').append(lunarMonths);

      // Birth year stem: Giap - At - Binh - Dinh - Mau - Ky - Canh - Tan - Nham - Quy
      var stems = Ziwei.Configs.Stems.Names.mapKeyValues((stem, name) =>
        '<option value="' + stem + '">' + name + '</value>'
      ).join("\n");
      $('#birthYearStem').append(stems);
    };

    function setupCalcButtonHandler(calculator) {
      $('#calcButton').click(() => {
        var name = $('#profileName').val() || '<N/A>';
        var gender = $('#gender').val();
        var birthHour = $('#birthHour').val();
        var birthDay = parseInt($('#birthDay').val());
        var birthMonth = $('#birthMonth').val();
        var birthYearStem = $('#birthYearStem').val();
        var birthYearBranch = $('#birthYearBranch').val();
        var key = [gender, birthHour, birthDay, birthMonth, birthYearStem, birthYearBranch].join("_")
        
        var resultTable = calculator.calculateUserInputProfile({
          'key': key,
          'name': name,
          'gender': gender,
          'birthHour': birthHour,
          'birthDay': birthDay,
          'birthMonth': birthMonth,
          'birthYear': {
            'stem': birthYearStem,
            'branch': birthYearBranch
          }
        });

        Ziwei.Calculator.renderHtml(resultTable);
      });
    };

    function setupTestButtonHandler(calculator) {
      var profileOptions = calculator.profiles.map((key, profile) =>
        '<option value="' + key + '">' + profile.name + '</value>'
      ).join("\n");
      $('#presetProfile').append(profileOptions);

      $('#testButton').click(() => {
        var profileKey = $("presetProfile").val();
        resultTable = calculator.calculatePresetProfile(profileKey);
        Ziwei.Calculator.renderHtml(resultTable);
      });
    };

    $(document).ready(() => {
      var calculator = new Ziwei.Calculator();
      setupDropdownValues();
      setupCalcButtonHandler(calculator);
      setupTestButtonHandler(calculator);
    });
  </script>
</head>
<body>
  <script id="result-template" type="text/x-handlebars-template">
    <div id="result-display">
      <canvas id="canvas" width="1138px" height="640px"></canvas>
      <div class="tuan-triet" style="top: {{ tuanPos.top }}px; left: {{ tuanPos.left }}px;">
        <span>Tuần</span>
      </div>
      <div class="tuan-triet" style="top: {{ trietPos.top }}px; left: {{ trietPos.left }}px;">
        <span>Triệt</span>
      </div>
      <table class="result-table" border="1">
        <tr>
          <td>{{{ renderedPalaces.ty2 }}}</td>
          <td>{{{ renderedPalaces.ngo }}}</td>
          <td>{{{ renderedPalaces.mui }}}</td>
          <td>{{{ renderedPalaces.than }}}</td>
        </tr>
        <tr>
          <td>{{{ renderedPalaces.thin }}}</td>
          <td rowspan="2" colspan="2" id="center-info">{{{ centerInfo }}}</td>
          <td>{{{ renderedPalaces.dau }}}</td>
        </tr>
        <tr>
          <td>{{{ renderedPalaces.mao }}}</td>
          <td>{{{ renderedPalaces.tuat }}}</td>
        </tr>
        <tr>
          <td>{{{ renderedPalaces.dan }}}</td>
          <td>{{{ renderedPalaces.suu }}}</td>
          <td>{{{ renderedPalaces.ty }}}</td>
          <td>{{{ renderedPalaces.hoi }}}</td>
        </tr>
      </table>
    </div>
  </script>
  <script id="palace-template" type="text/x-handlebars-template">
    <table class="palace {{ selfClass }} {{ bodyClass }}" width="280px" height="160px">
      <tr height="15%">
        <td width="30%" class="top left">{{ name }}</td>
        <td width="40%" class="top center empty"></td>
        <td width="30%" class="top right">{{ body }}</td>
      </tr>
      <tr height="15%">
        <td></td>
        <td rowspan="2" class="center main-stars">
          <div id="main-stars">{{{ mainStars }}}</div>
        </td>
        <td></td>
      </tr>
      <tr height="55%">
        <td class="left good-stars"><div>{{{ goodStars }}}</div></td>
        <td class="right bad-stars"><div>{{{ badStars }}}</div></td>
      </tr>
      <tr height="15%">
        <td class="bottom left">{{ position }}</td>
        <td class="bottom center">{{ trangSinhConstellation }}</td>
        <td class="bottom right">{{ opportunityAge }}</td>
      </tr>
    </table>
  </script>
  <script id="center-info-template" type="text/x-handlebars-template">
    <div class=center-info>
      <span>Tên: <b>{{ name }}</b></span>
      <span>Giờ sinh: <b>{{ birthHour }}</b></span>
      <span>
        Ngày sinh: <b>{{ birthDay }}</b> tháng <b>{{ birthMonth }}</b> năm <b>{{ birthYear }}</b>
      </span>
      <span>
        Bản mệnh: 
        <b style='{{ ageSymbolColorStyle }}'>{{ ageSymbol }}</b> ({{ yinyangGender }})
      </span>
      <span>
        Cục: <b style='{{ cucElementColorStyle }}'>{{ cucFullName }} ({{ cucNumber }})</b>
      </span>
    </div>
  </script>
  <div id="controls">
    <div style="padding-bottom: 10px;">
      Tên: <input id="profileName" type="text" placeholder="Họ và tên">
      <select id="gender">
        <option value='nam'>Nam</option>
        <option value='nu'>Nữ</option>
      </select>
      Giờ: <select id="birthHour"></select>
      Ngày: <select id="birthDay"></select>
      Tháng: <select id="birthMonth"></select>
      Năm: <select id="birthYearStem"></select><select id="birthYearBranch"></select>
      <button id="calcButton" type="button">Lập số</button>
    </div>
    <div>
      Test: <select id="presetProfile"></select>
      <button id="testButton" type="button">Test</button>
    </div>
  </div>
  <div id="result-display"></div>
</body>
</html>